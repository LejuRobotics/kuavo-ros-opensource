# 手臂标定无GUI版本使用说明

## 📋 脚本概述

`arm_cail_noui.py` 是机器人手臂关节标定的无GUI自动化版本，按照readme.md中描述的标准流程执行标定，用户只需确认是否保存标定结果。

## 🔧 主要改进

### 1. **正确的执行流程**
按照readme.md描述的标准流程执行：
1. **Enable Move** - 启用机器人移动功能
2. **Enable Head Tracking** - 启用头部追踪
3. **Hand Move** - 执行手臂示教运动（后台运行）
4. **数据收集** - 与手臂运动同时进行
5. **Filter Noise** - 过滤噪声数据
6. **Execute Calibration** - 执行标定算法
7. **用户确认** - 询问是否保存标定结果

### 2. **智能等待机制**
- 各步骤之间有适当的等待时间
- 手臂运动与数据收集并行进行
- 自动检测手臂运动状态
- 超时保护机制

### 3. **灵活的标定选项**
- 支持单手标定：`--side l` 或 `--side r`
- 支持双手标定：`--side both`（默认）
- 可配置采样数量：`--size N`

## 🚀 使用方法

### 基本用法

```bash
# 标定双手（默认）
python3 ./scripts/joint_cali/arm_cail_noui.py --real --size 15

# 只标定左手
python3 ./scripts/joint_cali/arm_cail_noui.py --real --side l --size 10

# 只标定右手  
python3 ./scripts/joint_cali/arm_cail_noui.py --real --side r --size 10

# 仿真模式
python3 ./scripts/joint_cali/arm_cail_noui.py --size 15
```

### 参数说明

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `--real` | False | 使用实物机器人 |
| `--size` | 15 | 每只手的采样数量 |
| `--side` | both | 标定范围：l(左), r(右), both(双手) |
| `--plot_size` | 1 | 绘图大小（兼容性参数） |

## 📋 执行流程详解

### 步骤1: 环境检查
- 检查ROS环境
- 初始化标定器
- 设置末端工具变换矩阵

### 步骤2: 用户确认
```
准备标定左手...
请确认机器人处于安全状态，按Enter继续...
```

### 步骤3: 自动标定流程
```
=========================================================
           开始左手自动标定流程
=========================================================
步骤1: 启用机器人移动功能...
✓ 机器人移动功能已启用
步骤2: 启用头部追踪...
✓ 头部追踪已启用
步骤3: 启动手臂示教运动...
✓ 手臂示教运动已在后台启动
步骤4: 在手臂运动过程中收集标定数据...
目标收集 15 个有效数据点...
```

### 步骤4: 数据收集监控
```
进度: 5/15 个数据点, 手臂运动: 运行中
进度: 12/15 个数据点, 手臂运动: 已完成
✓ 数据收集完成，共收集 15 个数据点
```

### 步骤5: 数据处理和标定
```
步骤5: 过滤噪声数据...
✓ 数据过滤完成: 15 → 13 个数据点
步骤6: 执行标定算法...
Calibration finished, apply new zero point? [y/N]
```

### 步骤6: 结果总结
```
=========================================================
                    标定结果总结
=========================================================
成功标定: 2/2 只手
🎉 所有手臂标定成功完成！
=========================================================
```

## ⚠️ 重要注意事项

### 1. **前置条件**
- 确保已完成头部标定
- 机器人控制系统正常运行
- AprilTag识别系统工作正常
- 标定立方体正确安装

### 2. **安全检查**
- 每次标定前确认机器人周围安全
- 确保有足够的运动空间
- 标定过程中保持观察

### 3. **数据质量**
- 确保AprilTag在相机视野内
- 避免遮挡和反光
- 保持良好的光照条件

## 🐛 故障排除

### 1. **数据收集失败**
- 检查AprilTag是否可见
- 确认相机工作正常
- 检查网络连接

### 2. **手臂运动异常**
- 确认bag文件存在
- 检查机器人控制模式
- 验证ROS话题通信

### 3. **标定结果异常**
- 增加采样数量
- 检查数据质量
- 重新进行头部标定

## 🔄 与一键启动脚本集成

`arm_cail_noui.py` 可以很容易地集成到一键启动脚本中：

```bash
# 在一键启动脚本中调用
python3 ./scripts/joint_cali/arm_cail_noui.py --real --size 15
```

这样就能实现完全自动化的机器人关节标定流程。 